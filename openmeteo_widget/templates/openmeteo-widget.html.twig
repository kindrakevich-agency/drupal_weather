{#
/**
 * @file
 * Template for Open-Meteo Weather Widget.
 *
 * Available variables:
 * - cities: Array of all configured cities
 * - selected_city: Currently selected city data
 * - weather_data: Weather data for the selected city
 * - meteo_client: OpenMeteoClient service for icon/description mapping
 */
#}
<div class="openmeteo-widget bg-white rounded-3xl shadow-lg p-8" data-widget-id="openmeteo-widget">
  {% if weather_data %}
    {# City Selector #}
    {% if cities|length > 1 %}
      <div class="mb-6">
        <select id="city-selector" class="block w-full rounded-md border-gray-300 shadow-sm focus:border-orange-500 focus:ring-orange-500">
          {% for city_id, city in cities %}
            <option value="{{ city.id }}" {% if selected_city.id == city.id %}selected{% endif %}>
              {{ city.name }}
            </option>
          {% endfor %}
        </select>
      </div>
    {% endif %}

    {# Header #}
    <div class="flex flex-col md:flex-row justify-between items-start mb-8">
      <div class="text-left mb-4 md:mb-0">
        <h1 class="text-3xl font-normal mb-1">{{ selected_city.name }}</h1>
        <p class="text-gray-500 text-lg">
          {{ weather_data.current.time|date('l, g:i A') }}
        </p>
      </div>
      <div class="text-left md:text-right text-gray-600">
        <p class="mb-1">{{ 'Humidity'|t }}: {{ weather_data.current.humidity }}%</p>
        <p class="mb-1">{{ 'Precipitation'|t }}: {{ weather_data.current.precipitation_probability }}%</p>
        <p>{{ 'Wind'|t }}: {{ weather_data.current.wind_speed }} km/h</p>
      </div>
    </div>

    {# Current Temperature #}
    <div class="flex items-center gap-6 mb-12">
      <div class="weather-icon-wrapper">
        {% if use_openweather_icons %}
          <img src="{{ meteo_client.getOpenWeatherIconUrl(weather_data.current.weather_code) }}"
               alt="{{ meteo_client.getWeatherDescription(weather_data.current.weather_code) }}"
               class="w-24 h-24">
        {% else %}
          {{ _self.weather_icon(meteo_client.getWeatherIcon(weather_data.current.weather_code)) }}
        {% endif %}
      </div>
      <div class="flex items-start">
        <span class="text-9xl font-bold leading-none">{{ weather_data.current.temperature|round }}</span>
        <div class="flex flex-col ml-2 mt-2">
          <span class="text-3xl font-normal">°C</span>
        </div>
      </div>
    </div>

    {# Weather Description #}
    <div class="mb-8 text-xl text-gray-600">
      {{ meteo_client.getWeatherDescription(weather_data.current.weather_code) }}
    </div>

    {# 8-Day Forecast #}
    <div class="grid grid-cols-4 grid-rows-2 gap-4">
      {% for day in weather_data.daily %}
        <div class="bg-gray-50 rounded-2xl p-6 text-center hover:bg-gray-100 transition-colors cursor-pointer">
          <div class="text-sm font-medium mb-4">
            {{ day.date|date('D j') }}
          </div>
          <div class="weather-icon-small mx-auto mb-4">
            {% if use_openweather_icons %}
              <img src="{{ meteo_client.getOpenWeatherIconUrl(day.weather_code) }}"
                   alt="{{ meteo_client.getWeatherDescription(day.weather_code) }}"
                   class="mx-auto">
            {% else %}
              {{ _self.weather_icon(meteo_client.getWeatherIcon(day.weather_code)) }}
            {% endif %}
          </div>
          <div class="font-semibold">
            <span class="text-xl">{{ day.temp_max|round }}°</span>
            <span class="text-gray-400 ml-1">{{ day.temp_min|round }}°</span>
          </div>
        </div>
      {% endfor %}
    </div>
  {% else %}
    <div class="text-center py-8">
      <p class="text-gray-500">{{ 'Unable to load weather data. Please try again later.'|t }}</p>
    </div>
  {% endif %}
</div>

{# Weather icon macro #}
{% macro weather_icon(icon_type) %}
  {% if icon_type == 'clear' %}
    <svg class="w-24 h-24 text-orange-400" fill="currentColor" viewBox="0 0 24 24">
      <circle cx="12" cy="12" r="5"/>
      <line x1="12" y1="1" x2="12" y2="3" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
      <line x1="12" y1="21" x2="12" y2="23" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
      <line x1="4.22" y1="4.22" x2="5.64" y2="5.64" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
      <line x1="18.36" y1="18.36" x2="19.78" y2="19.78" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
      <line x1="1" y1="12" x2="3" y2="12" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
      <line x1="21" y1="12" x2="23" y2="12" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
      <line x1="4.22" y1="19.78" x2="5.64" y2="18.36" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
      <line x1="18.36" y1="5.64" x2="19.78" y2="4.22" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
    </svg>
  {% elseif icon_type == 'partly-cloudy' %}
    <svg class="w-24 h-24 text-blue-300" fill="currentColor" viewBox="0 0 24 24">
      <path d="M18 10h-1.26A8 8 0 1 0 9 20h9a5 5 0 0 0 0-10z"/>
    </svg>
  {% elseif icon_type == 'rain' or icon_type == 'rain-heavy' %}
    <svg class="w-24 h-24 text-blue-500" fill="currentColor" viewBox="0 0 24 24">
      <path d="M18 10h-1.26A8 8 0 1 0 9 20h9a5 5 0 0 0 0-10z"/>
      <line x1="8" y1="19" x2="8" y2="21" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
      <line x1="12" y1="19" x2="12" y2="23" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
      <line x1="16" y1="19" x2="16" y2="21" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
    </svg>
  {% elseif icon_type == 'thunderstorm' %}
    <svg class="w-24 h-24 text-yellow-400" fill="currentColor" viewBox="0 0 24 24">
      <path d="M13 2L3 14h8l-1 8 10-12h-8l1-8z"/>
    </svg>
  {% elseif icon_type == 'snow' or icon_type == 'snow-heavy' %}
    <svg class="w-24 h-24 text-blue-200" fill="currentColor" viewBox="0 0 24 24">
      <path d="M12 2v20M2 12h20M4.93 4.93l14.14 14.14M4.93 19.07l14.14-14.14"/>
      <circle cx="12" cy="12" r="3"/>
    </svg>
  {% elseif icon_type == 'fog' %}
    <svg class="w-24 h-24 text-gray-400" fill="currentColor" viewBox="0 0 24 24">
      <line x1="3" y1="9" x2="21" y2="9" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
      <line x1="3" y1="13" x2="21" y2="13" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
      <line x1="3" y1="17" x2="21" y2="17" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
    </svg>
  {% else %}
    <svg class="w-24 h-24 text-gray-400" fill="currentColor" viewBox="0 0 24 24">
      <circle cx="12" cy="12" r="10" stroke="currentColor" stroke-width="2" fill="none"/>
      <line x1="12" y1="8" x2="12" y2="12" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
      <circle cx="12" cy="16" r="1"/>
    </svg>
  {% endif %}
{% endmacro %}
